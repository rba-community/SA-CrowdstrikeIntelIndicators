# DO NOT EDIT THIS FILE!
# Please make all changes to files in ../local.
# To make changes, copy the section/stanza you want to change from ./default
# into ../local and edit there.

[update_crowdstrike_intel_lookup(3)]
args = crowdstrike_type, es_type, lookup_name
definition = `crowdstrike_intel_index` type=$crowdstrike_type$ deleted!=true earliest=-30d@d\
| fillnull value="n/a" malicious_confidence, last_updated, malware_families, kill_chains \
| rename indicator as $es_type$, malicious_confidence as confidence, last_updated as updated \
| eval kill_chains=mvjoin(kill_chains, ","), malware_families=mvjoin(malware_families, ",")\
| eval description="confidence:" + confidence + "|" + "last_updated:" + updated + "|" + "malware_families:" + malware_families + "|" + "kill_chains:" + kill_chains \
| stats count latest(description) latest(updated) by $es_type$\
| rename latest(*) as *\
| fields - count\
| outputlookup max=0 $lookup_name$.csv
iseval = 0

[crowdstrike_intel_index]
definition = index=crowdstrike_ioc
iseval = 0
